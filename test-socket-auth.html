<!DOCTYPE html>
<html>
<head>
    <title>Test Socket.IO avec Auth</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Test Socket.IO avec Auth</h1>
    <div id="status">Tentative de connexion...</div>
    <div id="messages"></div>
    <button onclick="testConnect()">Se connecter</button>
    
    <script>
        let socket = null;
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');

        function addMessage(msg) {
            const p = document.createElement('p');
            p.innerHTML = new Date().toLocaleTimeString() + ' - ' + msg;
            messagesDiv.appendChild(p);
        }

        function testConnect() {
            if (socket) {
                socket.disconnect();
            }

            console.log('ðŸš€ Test connexion Socket.IO...');
            statusDiv.innerHTML = 'ðŸ”„ Connexion en cours...';
            
            socket = io('http://localhost:3001/api/socket', {
                auth: {
                    sessionToken: 'test-token',
                    userId: '68937e9a67fd70e1283b0378', // Admin ID existant
                    userRole: 'admin',
                    userName: 'Test Admin',
                    userEmail: 'admin@example.com'
                },
                transports: ['websocket', 'polling'],
                timeout: 10000
            });

            socket.on('connect', () => {
                console.log('âœ… Socket.IO Connected!', socket.id);
                statusDiv.innerHTML = 'âœ… ConnectÃ© (ID: ' + socket.id + ')';
                statusDiv.style.color = 'green';
                addMessage('âœ… Connexion rÃ©ussie !');
                
                // Tester un Ã©vÃ©nement
                socket.emit('request_online_users');
            });

            socket.on('disconnect', (reason) => {
                console.log('âŒ Socket.IO Disconnected:', reason);
                statusDiv.innerHTML = 'âŒ DÃ©connectÃ© (' + reason + ')';
                statusDiv.style.color = 'red';
                addMessage('âŒ DÃ©connexion: ' + reason);
            });

            socket.on('connect_error', (error) => {
                console.error('âŒ Socket.IO Error:', error);
                statusDiv.innerHTML = 'âŒ Erreur: ' + error.message;
                statusDiv.style.color = 'red';
                addMessage('âŒ Erreur: ' + error.message);
            });

            socket.on('online_users_list', (data) => {
                console.log('ðŸ‘¥ Online users:', data);
                addMessage('ðŸ‘¥ Utilisateurs en ligne: ' + data.users.length);
            });

            socket.on('error', (error) => {
                console.error('ðŸš« Server Error:', error);
                addMessage('ðŸš« Erreur serveur: ' + JSON.stringify(error));
            });
        }

        // Auto-connect
        setTimeout(testConnect, 1000);
    </script>
</body>
</html>